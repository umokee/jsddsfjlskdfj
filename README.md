# Task Manager

–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π task manager —Å FastAPI backend –∏ React frontend.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è NixOS

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ NixOS - —Å–º. **[QUICKSTART-NIXOS.md](QUICKSTART-NIXOS.md)**

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**: 0-10 (—á–∏—Å–ª–æ–≤–∞—è —à–∫–∞–ª–∞)
- **–≠–Ω–µ—Ä–≥–∏—è**: 0-5 (—É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞—á–∏)
- **–ü—Ä–∏–≤—ã—á–∫–∏**: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å –¥–µ–¥–ª–∞–π–Ω–∞–º–∏
- **API –∑–∞—â–∏—Ç–∞**: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ API –∫–ª—é—á—É
- **–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π UI**: —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å –æ—Å—Ç—Ä—ã–º–∏ —É–≥–ª–∞–º–∏

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–Ω–µ–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ (Roll)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ Start/Stop/Complete –∑–∞–¥–∞—á–∏
- ‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (urgency) –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ–¥–ª–∞–π–Ω–∞, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏ —ç–Ω–µ—Ä–≥–∏–∏
- ‚úÖ REST API —Å –∑–∞—â–∏—Ç–æ–π –ø–æ API –∫–ª—é—á—É

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### Backend

```bash
cd backend
pip install -r requirements.txt

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å API –∫–ª—é—á (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
export TASK_MANAGER_API_KEY="–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
python -m backend.main
```

Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`

### Frontend

```bash
cd frontend
npm install
npm run dev
```

Frontend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:5173`

## API Endpoints

–í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key` —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º.

### –ó–∞–¥–∞—á–∏

- `GET /api/tasks` - –≤—Å–µ –∑–∞–¥–∞—á–∏
- `GET /api/tasks/pending` - pending –∑–∞–¥–∞—á–∏ (sorted by urgency)
- `GET /api/tasks/current` - —Ç–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞ (–∞–∫—Ç–∏–≤–Ω–∞—è –∏–ª–∏ —Å–ª–µ–¥—É—é—â–∞—è)
- `GET /api/tasks/habits` - –ø—Ä–∏–≤—ã—á–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- `GET /api/tasks/{id}` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞
- `POST /api/tasks` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
- `PUT /api/tasks/{id}` - –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É
- `DELETE /api/tasks/{id}` - —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É

### –î–µ–π—Å—Ç–≤–∏—è

- `POST /api/tasks/start?task_id={id}` - –Ω–∞—á–∞—Ç—å –∑–∞–¥–∞—á—É (–∏–ª–∏ —Å–ª–µ–¥—É—é—â—É—é –µ—Å–ª–∏ ID –Ω–µ —É–∫–∞–∑–∞–Ω)
- `POST /api/tasks/stop` - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∑–∞–¥–∞—á—É
- `POST /api/tasks/done?task_id={id}` - –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É
- `POST /api/tasks/roll?mood={0-5}` - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- `GET /api/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –¥–µ–Ω—å

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–∞—á–∏

```json
{
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
  "project": "–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞",
  "priority": 5,
  "energy": 3,
  "is_habit": false,
  "is_today": false,
  "due_date": "2024-01-15T12:00:00"
}
```

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å API –∫–ª—é—á
API_KEY="your-secret-key-change-me"

# –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
curl -X POST http://localhost:8000/api/tasks \
  -H "X-API-Key: $API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "–ù–∞–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é",
    "priority": 7,
    "energy": 3,
    "is_today": true
  }'

# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É
curl http://localhost:8000/api/tasks/current \
  -H "X-API-Key: $API_KEY"

# –ù–∞—á–∞—Ç—å –∑–∞–¥–∞—á—É
curl -X POST http://localhost:8000/api/tasks/start \
  -H "X-API-Key: $API_KEY"

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É
curl -X POST http://localhost:8000/api/tasks/done \
  -H "X-API-Key: $API_KEY"

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å
curl -X POST http://localhost:8000/api/tasks/roll \
  -H "X-API-Key: $API_KEY"
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### API –∫–ª—é—á

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª—é—á `your-secret-key-change-me`. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
export TASK_MANAGER_API_KEY="–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á"
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite –±–∞–∑–∞ `tasks.db` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/var/log/task-manager/app.log` (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞) –∏–ª–∏ –≤ `./logs/app.log`.

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –ª–æ–≥–æ–≤:

```bash
export TASK_MANAGER_LOG_DIR="/–ø—É—Ç—å/–∫/–ª–æ–≥–∞–º"
export TASK_MANAGER_LOG_FILE="app.log"
```

## üîí –ó–∞—â–∏—Ç–∞ —Å Fail2ban

Task Manager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å API –∫–ª—é—á–æ–º, –≤–∫–ª—é—á–∞—è IP –∞–¥—Ä–µ—Å.

–ü–æ—Å–ª–µ 2 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ IP –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ 52 –Ω–µ–¥–µ–ª–∏ (–∏–ª–∏ –±–æ–ª—å—à–µ).

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–∞

```
2026-01-11 12:34:56 - task_manager.auth - WARNING - Invalid API key attempt from 192.168.1.100
```

### NixOS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ [`deployment/FAIL2BAN.md`](deployment/FAIL2BAN.md)

–ö—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è:

```nix
environment.etc."fail2ban/filter.d/task-manager-api.conf".text = ''
  [Definition]
  failregex = ^.*Invalid API key attempt from <HOST>.*$
  ignoreregex =
'';

services.fail2ban.jails.task-manager-api = {
  settings = {
    enabled = true;
    filter = "task-manager-api";
    logpath = "/var/log/task-manager/app.log";
    action = "iptables-allports";
    maxretry = 2;
    findtime = "1d";
    bantime = "52w";
  };
};
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
fail2ban-regex /var/log/task-manager/app.log /etc/fail2ban/filter.d/task-manager-api.conf

# –°—Ç–∞—Ç—É—Å
fail2ban-client status task-manager-api

# –†–∞–∑–±–∞–Ω–∏—Ç—å IP (–µ—Å–ª–∏ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–±–∞–Ω–∏–ª–∏ —Å–µ–±—è)
fail2ban-client set task-manager-api unbanip YOUR_IP
```

## Production Deployment

### NixOS (–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π) üöÄ

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —Å Git, —Å–±–æ—Ä–∫–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, fail2ban –∏ reverse proxy.

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: [`deployment/NIXOS-SETUP.md`](deployment/NIXOS-SETUP.md)

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```nix
{ config, pkgs, ... }:
{
  imports = [
    /–ø—É—Ç—å/–∫/umtask/deployment/nixos-module.nix
  ];

  services.task-manager = {
    enable = true;
  };
}
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- ‚úÖ –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–∑ Git
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π API –∫–ª—é—á
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (npm install + build)
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç FastAPI backend
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Caddy/Nginx reverse proxy
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç fail2ban –∑–∞—â–∏—Ç—É
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç systemd —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç—ã –≤ firewall

–ü–æ—Å–ª–µ `nixos-rebuild switch` ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `http://server:8080`

**–ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á:**
```bash
sudo cat /var/lib/task-manager-secrets/api-key
```

### Systemd (–¥—Ä—É–≥–∏–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤—ã)

–°–º. –ø—Ä–∏–º–µ—Ä —Å–µ—Ä–≤–∏—Å–∞ –≤ [`deployment/systemd-service.example`](deployment/systemd-service.example)

## –ê–ª–≥–æ—Ä–∏—Ç–º "Roll" (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞)

1. –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏
2. –û—á–∏—â–∞–µ—Ç —Ç–µ–≥ `is_today` —Å–æ –≤—Å–µ—Ö –æ–±—ã—á–Ω—ã—Ö –∑–∞–¥–∞—á
3. –î–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (–¥–µ–¥–ª–∞–π–Ω —á–µ—Ä–µ–∑ 2 –¥–Ω—è –∏–ª–∏ –º–µ–Ω—å—à–µ)
4. –î–æ–ø–æ–ª–Ω—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ –¥–æ –ª–∏–º–∏—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
5. –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —É—Ä–æ–≤–Ω—é —ç–Ω–µ—Ä–≥–∏–∏ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `mood`

## –í—ã—á–∏—Å–ª–µ–Ω–∏–µ Urgency

```python
urgency = priority * 10.0

if overdue:
    urgency += 50.0
elif due_in_2_days:
    urgency += 25.0
elif due_in_week:
    urgency += 10.0

if energy >= 4:
    urgency += 5.0
elif energy <= 1:
    urgency -= 1.0
```

## UI –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω**: —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞, –º–æ–Ω–æ—Ç–∏–ø–Ω—ã–π —à—Ä–∏—Ñ—Ç
- **–û—Å—Ç—Ä—ã–µ —É–≥–ª—ã**: –±–µ–∑ border-radius
- **–ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å**: –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ –æ–¥–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
- **Keyboard-friendly**: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –±–µ–∑ –º—ã—à–∏

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: FastAPI, SQLAlchemy, SQLite
- **Frontend**: React, Vite, Axios
- **–°—Ç–∏–ª—å**: Vanilla CSS (–±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤)

## License

MIT
